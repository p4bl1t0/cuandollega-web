"use strict";angular.module("cuandollegaWebApp").controller("MainCtrl",["$http","$scope","$timeout",function(e,n){n.bondis=[],n.calles=[],n.callesConParadas=[],n.paradas=[],n.intersecciones=[],n.colectivos=[],n.selectedStreet=null,n.selectedIntersection=null,n.selectedBus=null,n.arrivedInformation=[],n.list=[];var t=function(e){var o=localStorage.getItem("intersecciones");null===o?e.get("http://sam.162.243.6.106.xip.io/data.php?action=paradas").success(function(e){angular.forEach(e,function(e){angular.forEach(n.calles,function(n){n.id.toString()===e.idCalle.toString()&&(e.name=n.name),n.id.toString()===e.idInter.toString()&&(e.iName=n.name)})}),console.log(e),n.intersecciones=e,localStorage.setItem("intersecciones",JSON.stringify(n.intersecciones))}):n.intersecciones=JSON.parse(o)},o=function(e){if(null!==n.bondis)for(var a=0;a<n.bondis.length;a++){var t=n.bondis[a];if(t.id.toString()===e.toString())return t}},s=localStorage.getItem("bondis");null===s?e.get("http://sam.162.243.6.106.xip.io/data.php?action=bondis").success(function(a){console.log(a),n.bondis=a,localStorage.setItem("bondis",JSON.stringify(n.bondis)),t(e,n.intersecciones,n.calles)}):(n.bondis=JSON.parse(s),t(e,n.intersecciones,n.calles));var i=localStorage.getItem("calles"),l=localStorage.getItem("callesConParadas");null===i?e.get("http://sam.162.243.6.106.xip.io/data.php?action=calles").success(function(e){console.log(e),n.calles=e,angular.forEach(n.calles,function(e){"1"===e.hasStops&&n.callesConParadas.push(e)}),console.log(n.callesConParadas),localStorage.setItem("calles",JSON.stringify(n.calles)),localStorage.setItem("callesConParadas",JSON.stringify(n.callesConParadas))}):(n.calles=JSON.parse(i),n.callesConParadas=JSON.parse(l),n.list=n.callesConParadas),n.streetChange=function(){console.log(n.selectedStreet),n.paradas=[],angular.forEach(n.intersecciones,function(e){e.idCalle.toString()===n.selectedStreet.id.toString()&&n.paradas.push(e)}),console.log(n.paradas)},n.intersectionChange=function(){console.log(n.selectedIntersection),n.colectivos=[],angular.forEach(n.bondis,function(e){angular.forEach(n.selectedIntersection.bondis,function(a){e.id.toString()===a.id.toString()&&n.colectivos.push(e)})}),console.log(n.colectivos)},n.showArrivedInformation=function(){console.log(n.selectedBus),n.arrivedInformation=[],null!==n.selectedBus?(console.log("Parada:",n.selectedIntersection.parada),console.log("Linea:",n.selectedBus.linea),e.get("http://sam.162.243.6.106.xip.io/data.php?action=llegada&parada="+n.selectedIntersection.parada+"&linea="+n.selectedBus.linea).success(function(e){n.arrivedInformation.push(e)})):null!==n.selectedIntersection&&void 0!==n.selectedIntersection.bondis&&n.selectedIntersection.bondis.length>0?angular.forEach(n.selectedIntersection.bondis,function(a){a=o(a.id),e.get("http://sam.162.243.6.106.xip.io/data.php?action=llegada&parada="+n.selectedIntersection.parada+"&linea="+a.linea).success(function(e){n.arrivedInformation.push(e)})}):n.arrivedInformation.push("Seleccione alguna intersecci√≥n para conocer los horarios de arribo.")};var c=0,r=null;n.updateList=function(a){console.log(a),0===c?(n.list=[],angular.forEach(n.intersecciones,function(e){e.idCalle.toString()===a.id.toString()&&(e.name=e.iName,n.list.push(e))}),c++):1===c?(n.list=[],r=a,n.list.push({name:"- TODOS -",id:0}),angular.forEach(n.bondis,function(e){angular.forEach(a.bondis,function(a){e.id.toString()===a.id.toString()&&(e.name=e.linea,n.list.push(e))})}),c++):2===c&&(n.list=[],0===a.id||e.get("http://sam.162.243.6.106.xip.io/data.php?action=llegada&parada="+r.parada+"&linea="+a.name).success(function(e){n.list.push({name:e})}))}}]);