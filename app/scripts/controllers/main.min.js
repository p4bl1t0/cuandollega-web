"use strict";angular.module("cuandollegaWebApp").controller("MainCtrl",["$http","$scope","$timeout",function(e,t){t.bondis=[],t.calles=[],t.paradas=[],t.intersecciones=[],t.colectivos=[],t.selectedStreet=null,t.selectedIntersection=null,t.selectedBus=null,t.arrivedInformation="";var o=function(e){var s=localStorage.getItem("intersecciones");null===s?e.get("http://sam.162.243.6.106.xip.io/data.php?action=paradas").success(function(e){angular.forEach(e,function(e){angular.forEach(t.calles,function(t){t.id.toString()===e.idCalle.toString()&&(e.name=t.name),t.id.toString()===e.idInter.toString()&&(e.iName=t.name)})}),console.log(e),t.intersecciones=e,localStorage.setItem("intersecciones",JSON.stringify(t.intersecciones))}):t.intersecciones=JSON.parse(s)},s=localStorage.getItem("bondis");null===s?e.get("http://sam.162.243.6.106.xip.io/data.php?action=bondis").success(function(n){console.log(n),t.bondis=n,localStorage.setItem("bondis",JSON.stringify(t.bondis)),o(e,t.intersecciones,t.calles)}):(t.bondis=JSON.parse(s),o(e,t.intersecciones,t.calles));var a=localStorage.getItem("calles");null===a?e.get("http://sam.162.243.6.106.xip.io/data.php?action=calles").success(function(e){console.log(e),t.calles=e,localStorage.setItem("calles",JSON.stringify(t.calles))}):t.calles=JSON.parse(a),t.streetChange=function(){console.log(t.selectedStreet),t.paradas=[],angular.forEach(t.intersecciones,function(e){e.idCalle.toString()===t.selectedStreet.id.toString()&&t.paradas.push(e)}),console.log(t.paradas)},t.intersectionChange=function(){console.log(t.selectedIntersection),t.colectivos=[],angular.forEach(t.bondis,function(e){angular.forEach(t.selectedIntersection.bondis,function(n){e.id.toString()===n.id.toString()&&t.colectivos.push(e)})}),console.log(t.colectivos)},t.showArrivedInformation=function(){console.log("Parada:",t.selectedIntersection.parada),console.log("Linea:",t.selectedBus.linea),e.get("http://sam.162.243.6.106.xip.io/data.php?action=llegada&parada="+t.selectedIntersection.parada+"&linea="+t.selectedBus.linea).success(function(e){t.arrivedInformation=e})}}]);