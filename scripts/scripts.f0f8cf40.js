"use strict";angular.module("cuandollegaWebApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("cuandollegaWebApp").controller("MainCtrl",["$http","$scope","$timeout",function(a,b,c){b.bondis=[],b.calles=[],b.callesConParadas=[],b.paradas=[],b.intersecciones=[],b.colectivos=[],b.selectedStreet=null,b.selectedIntersection=null,b.selectedBus=null,b.arrivedInformation=[],b.list=[];var d=function(a,c,d){var e=localStorage.getItem("intersecciones");null===e?a.get("http://sam.162.243.6.106.xip.io/data.php?action=paradas").success(function(a){angular.forEach(a,function(a){angular.forEach(b.calles,function(b){b.id.toString()===a.idCalle.toString()&&(a.name=b.name),b.id.toString()===a.idInter.toString()&&(a.iName=b.name)})}),console.log(a),b.intersecciones=a,localStorage.setItem("intersecciones",JSON.stringify(b.intersecciones))}):b.intersecciones=JSON.parse(e)},e=function(a){if(null!==b.bondis)for(var c=0;c<b.bondis.length;c++){var d=b.bondis[c];if(d.id.toString()===a.toString())return d}},f=localStorage.getItem("bondis");null===f?a.get("http://sam.162.243.6.106.xip.io/data.php?action=bondis").success(function(c){console.log(c),b.bondis=c,localStorage.setItem("bondis",JSON.stringify(b.bondis)),d(a,b.intersecciones,b.calles)}):(b.bondis=JSON.parse(f),d(a,b.intersecciones,b.calles));var g=localStorage.getItem("calles"),h=localStorage.getItem("callesConParadas");null===g?a.get("http://sam.162.243.6.106.xip.io/data.php?action=calles").success(function(a){console.log(a),b.calles=a,angular.forEach(b.calles,function(a){"1"===a.hasStops&&b.callesConParadas.push(a)}),console.log(b.callesConParadas),localStorage.setItem("calles",JSON.stringify(b.calles)),localStorage.setItem("callesConParadas",JSON.stringify(b.callesConParadas))}):(b.calles=JSON.parse(g),b.callesConParadas=JSON.parse(h),b.list=b.callesConParadas),b.streetChange=function(){console.log(b.selectedStreet),b.paradas=[],angular.forEach(b.intersecciones,function(a){a.idCalle.toString()===b.selectedStreet.id.toString()&&b.paradas.push(a)}),console.log(b.paradas)},b.intersectionChange=function(){console.log(b.selectedIntersection),b.colectivos=[],angular.forEach(b.bondis,function(a){angular.forEach(b.selectedIntersection.bondis,function(c){a.id.toString()===c.id.toString()&&b.colectivos.push(a)})}),console.log(b.colectivos)},b.showArrivedInformation=function(){console.log(b.selectedBus),b.arrivedInformation=[],null!==b.selectedBus?(console.log("Parada:",b.selectedIntersection.parada),console.log("Linea:",b.selectedBus.linea),a.get("http://sam.162.243.6.106.xip.io/data.php?action=llegada&parada="+b.selectedIntersection.parada+"&linea="+b.selectedBus.linea).success(function(a){b.arrivedInformation.push(a)})):null!==b.selectedIntersection&&void 0!==b.selectedIntersection.bondis&&b.selectedIntersection.bondis.length>0?angular.forEach(b.selectedIntersection.bondis,function(c){c=e(c.id),a.get("http://sam.162.243.6.106.xip.io/data.php?action=llegada&parada="+b.selectedIntersection.parada+"&linea="+c.linea).success(function(a){b.arrivedInformation.push(a)})}):b.arrivedInformation.push("Seleccione alguna intersecci√≥n para conocer los horarios de arribo.")};var i=0,j=null;b.updateList=function(c){console.log(c),0===i?(b.list=[],angular.forEach(b.intersecciones,function(a){a.idCalle.toString()===c.id.toString()&&(a.name=a.iName,b.list.push(a))}),i++):1===i?(b.list=[],j=c,b.list.push({name:"- TODOS -",id:0}),angular.forEach(b.bondis,function(a){angular.forEach(c.bondis,function(c){a.id.toString()===c.id.toString()&&(a.name=a.linea,b.list.push(a))})}),i++):2===i&&(b.list=[],0===c.id||a.get("http://sam.162.243.6.106.xip.io/data.php?action=llegada&parada="+j.parada+"&linea="+c.name).success(function(a){b.list.push({name:a})}))}}]),angular.module("cuandollegaWebApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);